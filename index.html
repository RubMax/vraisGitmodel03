<!DOCTYPE html>
<html lang="fr">
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accueil</title>
  <!-- lien CSS pour ajouter avant </head> -->
  <link rel="stylesheet" href="styles.css">

  <!-- Version alternative pour meilleure compatibilité -->
 <link rel="apple-touch-icon" sizes="180x180" href="https://iili.io/FAW7bOx.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://iili.io/FAW7bOx.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://iili.io/FAW7bOx.png">
  

  <!-- lien manifest RAW de GIT pour ajouter avant </head> -->
  <link rel="manifest" href="https://raw.githubusercontent.com/RubMax/vraisGitmodel03/refs/heads/main/manifest.json">
 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
  <header>
    <div id="headerOverlay" class="header-overlay">
      <img id="logo" class="logo" src="" alt="Logo">
      <div class="header-center">
        <h1 id="nomEntreprise"></h1>
        <p id="slogant"></p>
      </div>
    </div>
  </header>

  <nav class="sidebar" id="sidebarMenu">
    <a href="javascript:void(0)" class="active" onclick="filtrerParType('tous')">Menu</a>
  </nav>

  <div class="content-container">
    <div id="servicesContainer"></div>
    <footer>
      
      <p><span id="adresse"></span></p>
      <p>Tél: <span id="telfix"></span> | WhatsApp: <span id="whatsapp"></span></p>
      <p>Email: <span id="email"></span></p>
      <p>Domaine: <span id="domaine"></span></p>
    </footer>
  </div>



<script>
let allServicesData = [];
    let groupedServices = {};
    let whatsappNumber = "";
    const colors = ["#e74c3c", "#8e44ad", "#3498db", "#16a085", "#f39c12", "#d35400", "#2c3e50"];

      // Chargement des données =========================================================================lien scrip + ?page=data ============================================================================================= a la placede doget pour load donnees
      document.addEventListener('DOMContentLoaded', function() {
  fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vQWTlKHTAiR3wWiyYkvXWyT1vwlmPH6hRPvrfkfpJmVa0oqDAzlxTmgQSTKSQsPST9NAPil9kPH1yHj/pub?gid=0&single=true&output=csv')
    .then(response => response.json())
    .then(displayProduits)
    .catch(err => {
      document.getElementById("produits").innerHTML =
        "<div class='alert alert-danger'>"+err.message+"</div>";
    });
  setupHorizontalDragScroll();
});
    

function renderPage(data) {
      allServicesData = data.services;
      whatsappNumber = data.entete.whatsapp;

      document.getElementById("nomEntreprise").innerText = data.entete.nomEntreprise;
      document.getElementById("logo").src = data.entete.imgLogo;
      document.getElementById("slogant").innerText = data.entete.slogant;
      document.getElementById("headerOverlay").style.backgroundImage = `url('${data.entete.imgEntete}')`;
      document.getElementById("adresse").innerText = data.entete.adresse;
      document.getElementById("telfix").innerText = data.entete.telFix;
      document.getElementById("whatsapp").innerText = data.entete.whatsapp;
      document.getElementById("email").innerText = data.entete.email;
      document.getElementById("domaine").innerText = data.entete.domaine;

      groupedServices = {};
      const sidebarMenu = document.getElementById("sidebarMenu");
      const typesAjoutes = new Set();

      let colorIndex = 0;

      data.services.forEach(service => {
        if (!groupedServices[service.type]) groupedServices[service.type] = [];
        groupedServices[service.type].push(service);

        if (!typesAjoutes.has(service.type)) {
          const link = document.createElement("a");
          link.href = "javascript:void(0)";
          link.textContent = service.type;
          link.style.backgroundColor = colors[colorIndex % colors.length];
          link.dataset.originalColor = colors[colorIndex % colors.length];
          link.addEventListener("click", (e) => {
            e.preventDefault();
            filtrerParType(service.type);
          });
          sidebarMenu.appendChild(link);
          typesAjoutes.add(service.type);
          colorIndex++;
        }
      });

      afficherArticles(data.services, "Menu");
    }

    function afficherArticles(liste, titre) {
      const container = document.getElementById("servicesContainer");
      container.innerHTML = "";

      const sectionTitle = document.createElement("div");
      sectionTitle.className = "section-title";
      sectionTitle.textContent = titre;
      container.appendChild(sectionTitle);

      const cards = document.createElement("div");
      cards.className = "cards-container";

      liste.forEach(service => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${service.img}" alt="${service.nom}">
          <div class="card-body">
            <div class="card-title">${service.nom}</div>
            <div class="card-desc">${service.description}</div>
            <div class="card-price">R$ ${service.prix}</div>
          </div>
        `;
        cards.appendChild(card);
      });

      container.appendChild(cards);
    }

    function filtrerParType(type) {
      const links = document.querySelectorAll("#sidebarMenu a");
      links.forEach(link => {
        link.classList.remove("active");
        link.style.backgroundColor = link.dataset.originalColor;
        link.style.color = "white";
        if (link.textContent === type || (type === 'tous' && link.textContent === 'Menu')) {
          link.classList.add("active");
          link.style.backgroundColor = "white";
          link.style.color = "black";
        }
      });

      if (type === 'tous') {
        afficherArticles(allServicesData, "Menu");
      } else {
        afficherArticles(groupedServices[type] || [], type);
      }
    }





  // =======Fonction pour afficher les instructions d'installation =============================================================================================================================================================
  function showInstallInstructions() {
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isAndroid = /Android/.test(navigator.userAgent);
    
    let instructions = '';
    
    if (isIOS) {
      instructions = `
        <div style="text-align: center; padding: 20px;">
          <h3>Pour ajouter à l'écran d'accueil :</h3>
          <p>1. Appuyez sur le bouton "Partager"</p>
          <p>2. Sélectionnez "Sur l'écran d'accueil"</p>
          <p>3. Appuyez sur "Ajouter"</p>
          <img src="https://i.imgur.com/9z2wDf1.png" style="max-width: 200px; margin-top: 10px;">
        </div>
      `;
    } else if (isAndroid) {
      instructions = `
        <div style="text-align: center; padding: 20px;">
          <h3>Pour ajouter à l'écran d'accueil :</h3>
          <p>1. Appuyez sur les trois points en haut à droite</p>
          <p>2. Sélectionnez "Ajouter à l'écran d'accueil"</p>
          <p>3. Confirmez l'installation</p>
          <img src="https://i.imgur.com/7XbJ2uQ.png" style="max-width: 200px; margin-top: 10px;">
        </div>
      `;
    } else {
      instructions = '<p>Cette fonctionnalité est disponible uniquement sur mobile.</p>';
    }
    
    const popup = document.createElement('div');
    popup.style.position = 'fixed';
    popup.style.top = '0';
    popup.style.left = '0';
    popup.style.width = '100%';
    popup.style.height = '100%';
    popup.style.backgroundColor = 'rgba(0,0,0,0.9)';
    popup.style.display = 'flex';
    popup.style.justifyContent = 'center';
    popup.style.alignItems = 'center';
    popup.style.zIndex = '9999';
    popup.style.color = 'white';
    popup.style.fontSize = '1.2em';
    
    popup.innerHTML = `
      <div style="background: #fff; color: #333; padding: 20px; border-radius: 10px; max-width: 90%;">
        ${instructions}
        <button style="margin-top: 20px; padding: 10px 20px; background: #83addc; color: white; border: none; border-radius: 5px; cursor: pointer;">
          Fermer
        </button>
      </div>
    `;
    
    popup.querySelector('button').addEventListener('click', () => {
      document.body.removeChild(popup);
    });
    
    document.body.appendChild(popup);
  }

  // Vérifier si l'API d'installation est disponible
  if ('BeforeInstallPromptEvent' in window) {
    let deferredPrompt;
    
    window.addEventListener('beforeinstallprompt', (e) => {
      // Empêcher l'affichage automatique du prompt
      e.preventDefault();
      // Stocker l'événement pour l'utiliser plus tard
      deferredPrompt = e;
      
      // Afficher le prompt d'installation
      deferredPrompt.prompt();
      
      // Attendre la réponse de l'utilisateur
      deferredPrompt.userChoice.then((choiceResult) => {
        if (choiceResult.outcome === 'accepted') {
          console.log('L\'utilisateur a accepté l\'installation');
        } else {
          console.log('L\'utilisateur a refusé l\'installation');
        }
        deferredPrompt = null;
      });
    });
  } else {
    // Si l'API n'est pas disponible, afficher les instructions manuelles
    showInstallInstructions();
  };



 </script>


  <button id="installAppBtn" style="display:none;position:fixed;bottom:30px;right:30px;padding:15px 22px;background:#83addc;color:#fff;border:none;border-radius:8px;font-size:1.2em;z-index:9999;box-shadow:0 2px 10px rgba(0,0,0,0.15);cursor:pointer;">
  Installer RubMax Servicos
</button>

<script>
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installAppBtn').style.display = 'block';
});

document.getElementById('installAppBtn').addEventListener('click', () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        document.getElementById('installAppBtn').style.display = 'none';
      }
      deferredPrompt = null;
    });
  }
});
</script> 
</body>
</html>
